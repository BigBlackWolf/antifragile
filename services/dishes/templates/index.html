{% extends "base.html" %}

{% block content %}
<div id="add_dish" class="container">
    <div class="row">
            <form id="addForm" class="form-group">
                <div class="input-group">
                    <input id="name" name="name" type="text" placeholder="Название блюда" class="form-control">
                    <div class="input-group-append">
                        <input type="submit" class="btn btn-success" value="Отправить">
                    </div>
                </div>
            </form>
    </div>
    {% for item in message %}
    <div id="{{ item.id }}" class="row">
        <div class="alert alert-primary col-8">
            <a href="/dishes/{{ item.id }}">
                <div>{{ item.name }}</div>
            </a>
        </div>
        <div class="col-4">
            <button class="btn btn-primary" onclick="deleteDish({{ item.id }})">Удалить</button>
        </div>
    </div>
    {% endfor %}
</div>

<script>
    function deleteDish(id) {
        fetch('/dishes/' + id, {
            method: 'DELETE',
        })
            .then(response => {
                if (response.status === 200) {
                    document.getElementById(id).remove();
                }
            });
    }

    addForm.onsubmit = async (e) => {
        e.preventDefault();
        let data = new FormData(addForm)
        var object = {};
        data.forEach((value, key) => {object[key] = value});

        const response = await fetch('/dishes', {
            method: 'POST',
            body: JSON.stringify(object)
        });

        let new_dish_id = await response.json();
        var new_div = document.createElement("div");
        new_div.innerHTML = `<div class=\"alert alert-primary col-8\">
                        <a href=\"/dishes/${new_dish_id["message"]}\">
                            <div>${object["name"]}</div>
                        </a>
                    </div>
                    <div class=\"col-4\">
                        <button class=\"btn btn-primary\" onclick=\"deleteDish(${new_dish_id["message"]})\">Удалить</button>
                    </div>`
        new_div.setAttribute("id", new_dish_id["message"]);
        new_div.setAttribute("class", "row");
        add_dish1 = document.getElementById("add_dish")
        add_dish1.appendChild(new_div)
    }

</script>
{% endblock %}